from pre import utils
from os.path import join

#configfile: 'config.yaml'

exp_dir = config['experiment_directory']
exp_config = config.get('experiment_config','logs/config.cfg')
exp_config = join(exp_dir, exp_config)

experiment_name = utils.get_exp_name(exp_config)

output_dir = join(config['output_directory'], experiment_name)
sections = utils.parse_sections(exp_config)

rule all:
    input:
        expand('{dir}/processed_zarr/{s}.zarr', dir = output_dir, s = sections)

rule fix_lighting:
    input:
        {exp_config}
    params:
        save_path = output_dir,
        section = '{sections}'
    output:
        '{output_dir}/processed_zarr/{sections}.zarr',
        '{output_dir}/processed_zarr/{sections}.attr'
    script:
        'scripts/preprocess.py'
